# AUTO-GENERATED by orb-schema-generator v2.0.3 - DO NOT EDIT
# Regenerate with: orb-schema generate
from aws_cdk import Stack, CfnOutput
from constructs import Construct

from generated.tables.application_api_keys_table import ApplicationApiKeysTable
from generated.tables.application_environment_config_table import ApplicationEnvironmentConfigTable
from generated.tables.application_roles_table import ApplicationRolesTable
from generated.tables.applications_table import ApplicationsTable
from generated.tables.application_user_roles_table import ApplicationUserRolesTable
from generated.tables.notifications_table import NotificationsTable
from generated.tables.organizations_table import OrganizationsTable
from generated.tables.organization_users_table import OrganizationUsersTable
from generated.tables.ownership_transfer_requests_table import OwnershipTransferRequestsTable
from generated.tables.privacy_requests_table import PrivacyRequestsTable
from generated.tables.sms_rate_limit_table import SmsRateLimitTable
from generated.tables.users_table import UsersTable
from generated.appsync.api import AppSyncApi
from generated.appsync.sdk_api import AppSyncSdkApi


class BackendStackStack(Stack):
    """CDK Stack for backend infrastructure."""

    def __init__(
        self,
        scope: Construct,
        id: str,
        **kwargs,
    ) -> None:
        super().__init__(scope, id, **kwargs)

        # Create DynamoDB tables
        application_api_keys_table = ApplicationApiKeysTable(self, 'ApplicationApiKeysTable')
        application_environment_config_table = ApplicationEnvironmentConfigTable(self, 'ApplicationEnvironmentConfigTable')
        application_roles_table = ApplicationRolesTable(self, 'ApplicationRolesTable')
        applications_table = ApplicationsTable(self, 'ApplicationsTable')
        application_user_roles_table = ApplicationUserRolesTable(self, 'ApplicationUserRolesTable')
        notifications_table = NotificationsTable(self, 'NotificationsTable')
        organizations_table = OrganizationsTable(self, 'OrganizationsTable')
        organization_users_table = OrganizationUsersTable(self, 'OrganizationUsersTable')
        ownership_transfer_requests_table = OwnershipTransferRequestsTable(self, 'OwnershipTransferRequestsTable')
        privacy_requests_table = PrivacyRequestsTable(self, 'PrivacyRequestsTable')
        sms_rate_limit_table = SmsRateLimitTable(self, 'SmsRateLimitTable')
        users_table = UsersTable(self, 'UsersTable')

        # Create Main AppSync API with Cognito authentication (all tables)
        main_api = AppSyncApi(
            self,
            "AppSyncApi",
            tables={
                "ApplicationApiKeys": application_api_keys_table.table,
                "ApplicationEnvironmentConfig": application_environment_config_table.table,
                "ApplicationRoles": application_roles_table.table,
                "Applications": applications_table.table,
                "ApplicationUserRoles": application_user_roles_table.table,
                "Notifications": notifications_table.table,
                "Organizations": organizations_table.table,
                "OrganizationUsers": organization_users_table.table,
                "OwnershipTransferRequests": ownership_transfer_requests_table.table,
                "PrivacyRequests": privacy_requests_table.table,
                "SmsRateLimit": sms_rate_limit_table.table,
                "Users": users_table.table,
            },
        )

        # Create SDK AppSync API with Lambda authorizer (Users and Applications only)
        sdk_api = AppSyncSdkApi(
            self,
            "AppSyncSdkApi",
            tables={
                "Users": users_table.table,
                "Applications": applications_table.table,
            },
        )

        # CloudFormation Outputs
        CfnOutput(
            self, "MainGraphQLApiUrl",
            value=main_api.api.graphql_url,
            description="Main GraphQL API URL (Cognito auth)",
        )

        CfnOutput(
            self, "SdkGraphQLApiUrl",
            value=sdk_api.api.graphql_url,
            description="SDK GraphQL API URL (Lambda auth)",
        )

        CfnOutput(
            self, "ApplicationApiKeysTableName",
            value=application_api_keys_table.table.table_name,
            description="ApplicationApiKeys DynamoDB table name",
        )

        CfnOutput(
            self, "ApplicationEnvironmentConfigTableName",
            value=application_environment_config_table.table.table_name,
            description="ApplicationEnvironmentConfig DynamoDB table name",
        )

        CfnOutput(
            self, "ApplicationRolesTableName",
            value=application_roles_table.table.table_name,
            description="ApplicationRoles DynamoDB table name",
        )

        CfnOutput(
            self, "ApplicationsTableName",
            value=applications_table.table.table_name,
            description="Applications DynamoDB table name",
        )

        CfnOutput(
            self, "ApplicationUserRolesTableName",
            value=application_user_roles_table.table.table_name,
            description="ApplicationUserRoles DynamoDB table name",
        )

        CfnOutput(
            self, "NotificationsTableName",
            value=notifications_table.table.table_name,
            description="Notifications DynamoDB table name",
        )

        CfnOutput(
            self, "OrganizationsTableName",
            value=organizations_table.table.table_name,
            description="Organizations DynamoDB table name",
        )

        CfnOutput(
            self, "OrganizationUsersTableName",
            value=organization_users_table.table.table_name,
            description="OrganizationUsers DynamoDB table name",
        )

        CfnOutput(
            self, "OwnershipTransferRequestsTableName",
            value=ownership_transfer_requests_table.table.table_name,
            description="OwnershipTransferRequests DynamoDB table name",
        )

        CfnOutput(
            self, "PrivacyRequestsTableName",
            value=privacy_requests_table.table.table_name,
            description="PrivacyRequests DynamoDB table name",
        )

        CfnOutput(
            self, "SmsRateLimitTableName",
            value=sms_rate_limit_table.table.table_name,
            description="SmsRateLimit DynamoDB table name",
        )

        CfnOutput(
            self, "UsersTableName",
            value=users_table.table.table_name,
            description="Users DynamoDB table name",
        )

