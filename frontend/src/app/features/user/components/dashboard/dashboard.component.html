<!-- 
file: frontend/src/app/features/user/components/dashboard/dashboard.component.html
author: Corey Dale Peters
date: 2025-03-07
description: HTML template file
-->

<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="dashboard-header__content">
      <div class="dashboard-header__flex-container">
        <div class="dashboard-header__logo-section">
          <img src="../../../../../assets/onredboot-logo.jpg" alt="OneRedBoot Logo" class="dashboard-header__logo">
        </div>
        <div class="dashboard-header__text-section" *ngIf="currentUser$ | async as user">
          <div class="dashboard-header__greeting">
            <div class="dashboard-header__icon-title">
              <img src="../../../../../assets/hardhat.jpg" alt="Engineering" class="dashboard-header__icon">
              <h1 class="dashboard-header__title">
                Integration Hub
              </h1>
            </div>
            <p class="dashboard-header__subtitle">Your integration hub is ready for action</p>
            <div class="dashboard-header__status">
              <span class="dashboard-header__status-badge" 
                    [ngClass]="'dashboard-header__status-badge--' + getStatusClass(user.status)">
                <fa-icon [icon]="user.status === 'ACTIVE' ? 'check-circle' : 'clock'" class="dashboard-header__status-icon"></fa-icon>
                Account {{ user.status }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-content" *ngIf="currentUser$ | async as user; else loadingUser">
    
    <!-- Quick Actions Card -->
    <div class="dashboard-card dashboard-card--actions">
      <div class="dashboard-card__header">
        <h2 class="dashboard-card__title">
          <fa-icon icon="bolt" class="dashboard-card__icon"></fa-icon>
          Quick Actions
        </h2>
      </div>
      
      <div class="dashboard-card__content">
        <div class="action-grid">
          <a routerLink="/profile" class="action-button action-button--primary">
            <fa-icon icon="user-edit" class="action-button__icon"></fa-icon>
            <div class="action-button__content">
              <div class="action-button__title">Edit Profile</div>
              <div class="action-button__subtitle">Update your information</div>
            </div>
          </a>
          
          <button class="action-button action-button--secondary">
            <fa-icon icon="shield-alt" class="action-button__icon"></fa-icon>
            <div class="action-button__content">
              <div class="action-button__title">Security Settings</div>
              <div class="action-button__subtitle">Manage MFA & passwords</div>
            </div>
          </button>
          
          <button class="action-button action-button--secondary">
            <fa-icon icon="credit-card" class="action-button__icon"></fa-icon>
            <div class="action-button__content">
              <div class="action-button__title">Payment Methods</div>
              <div class="action-button__subtitle">Billing & subscriptions</div>
            </div>
          </button>
          
          <button class="action-button action-button--secondary">
            <fa-icon icon="cog" class="action-button__icon"></fa-icon>
            <div class="action-button__content">
              <div class="action-button__title">Integrations</div>
              <div class="action-button__subtitle">Connect your tools</div>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Account Health Card -->
    <div class="dashboard-card dashboard-card--health">
      <div class="dashboard-card__header">
        <h2 class="dashboard-card__title">
          <fa-icon icon="heartbeat" class="dashboard-card__icon"></fa-icon>
          Account Health
        </h2>
      </div>
      
      <div class="dashboard-card__content">
        <div class="health-check">
          <div class="health-item" 
               [ngClass]="user.emailVerified ? 'health-item--healthy' : 'health-item--warning'">
            <fa-icon [icon]="user.emailVerified ? 'check-circle' : 'exclamation-triangle'" 
                     class="health-item__icon"></fa-icon>
            <div class="health-item__content">
              <div class="health-item__title">Email Verification</div>
              <div class="health-item__status">
                {{ user.emailVerified ? 'Verified' : 'Action Required' }}
              </div>
            </div>
          </div>
          
          <div class="health-item" 
               [ngClass]="user.phoneVerified ? 'health-item--healthy' : 'health-item--warning'">
            <fa-icon [icon]="user.phoneVerified ? 'check-circle' : 'exclamation-triangle'" 
                     class="health-item__icon"></fa-icon>
            <div class="health-item__content">
              <div class="health-item__title">Phone Verification</div>
              <div class="health-item__status">
                {{ user.phoneVerified ? 'Verified' : (user.phoneNumber ? 'Action Required' : 'Not Set') }}
              </div>
            </div>
          </div>
          
          <div class="health-item" 
               [ngClass]="isUserValid(user) ? 'health-item--healthy' : 'health-item--warning'">
            <fa-icon [icon]="isUserValid(user) ? 'check-circle' : 'exclamation-triangle'" 
                     class="health-item__icon"></fa-icon>
            <div class="health-item__content">
              <div class="health-item__title">Profile Completion</div>
              <div class="health-item__status">
                {{ isUserValid(user) ? 'Complete' : 'Incomplete' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity Card -->
    <div class="dashboard-card dashboard-card--activity">
      <div class="dashboard-card__header">
        <h2 class="dashboard-card__title">
          <fa-icon icon="history" class="dashboard-card__icon"></fa-icon>
          Recent Activity
        </h2>
      </div>
      
      <div class="dashboard-card__content">
        <div class="activity-list">
          <div class="activity-item">
            <div class="activity-item__time">{{ formatDate(user.updatedAt) }}</div>
            <div class="activity-item__description">Profile information updated</div>
          </div>
          <div class="activity-item">
            <div class="activity-item__time">{{ formatDate(user.createdAt) }}</div>
            <div class="activity-item__description">Account created</div>
          </div>
          <div class="empty-state">
            <fa-icon icon="info-circle" class="empty-state__icon"></fa-icon>
            <p class="empty-state__text">More activity will appear here as you use the platform</p>
          </div>
        </div>
      </div>
    </div>

  </div>
  
  <!-- Loading template when no user data is available -->
  <ng-template #loadingUser>
    <div class="dashboard-content" style="text-align: center; padding: 40px;">
      <div class="loading-state">
        <h2>Loading your dashboard...</h2>
        <p>Please wait while we fetch your user information.</p>
      </div>
    </div>
  </ng-template>
  
  <!-- Debug section - Always show for troubleshooting -->
  <div class="dashboard__debug" style="background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px;">
    <h3 class="dashboard__debug-title">Debug Information</h3>
    
    <div class="dashboard__debug-section">
      <h4>Current User Observable Status</h4>
      <ng-container *ngIf="currentUser$ | async as user; else noUser">
        <p><strong>User Data Found:</strong></p>
        <pre style="background: #fff; padding: 10px; border-radius: 4px;">{{ user | json }}</pre>
        <p><strong>User Is Valid:</strong> {{ isUserValid(user) }}</p>
        <p><strong>Required Attributes Check:</strong></p>
        <ul>
          <li>Email: {{ !!user.email }} ({{ user.email }})</li>
          <li>First Name: {{ !!user.firstName }} ({{ user.firstName }})</li>
          <li>Last Name: {{ !!user.lastName}} ({{ user.lastName }})</li>
          <li>Phone Number: {{ !!user.phoneNumber}} ({{ user.phoneNumber }})</li>
          <li>Status Is Active: {{ user.status === 'ACTIVE' }} ({{ user.status }})</li>
        </ul>
      </ng-container>
      <ng-template #noUser>
        <p style="color: red;"><strong>No User Data Found</strong></p>
        <p>currentUser$ observable is emitting null or undefined</p>
      </ng-template>
    </div>
    
    <div class="dashboard__debug-section">
      <h4>Debug Mode Status</h4>
      <p>Debug Mode: {{ (debugMode$ | async) ? 'ON' : 'OFF' }}</p>
    </div>
  </div>
</div>