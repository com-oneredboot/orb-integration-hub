<!-- Users List Component Template -->

<app-user-page
  [heroTitle]="'Users'"
  [heroSubtitle]="'View users assigned to applications'"
  [breadcrumbItems]="breadcrumbItems"
  [tabs]="tabs"
  [activeTabId]="activeTab"
  (tabChange)="onTabChange($event)">

  <!-- Page Content -->
  <div class="orb-card">
    <!-- Header -->
    <div class="orb-card__header">
      <h2 class="orb-card__title">
        <fa-icon icon="users" class="orb-card__icon"></fa-icon>
        Application Users
      </h2>
      <div class="orb-card__header-actions">
        <button class="orb-card-btn" (click)="onRefresh()">
          <fa-icon icon="refresh" class="orb-card-btn__icon"></fa-icon>
          Refresh
        </button>
      </div>
    </div>

    <!-- Error Display -->
    <div class="orb-card__content" *ngIf="error$ | async as error">
      <div class="orb-error-message">
        <fa-icon icon="exclamation-triangle" class="orb-error-message__icon"></fa-icon>
        <div class="orb-error-message__content">
          <h3 class="orb-error-message__title">Unable to load users</h3>
          <p class="orb-error-message__text">{{ error }}</p>
          <button class="orb-btn orb-btn--primary" (click)="onRetry()">
            <fa-icon icon="refresh" class="orb-btn__icon"></fa-icon>
            Retry
          </button>
        </div>
      </div>
    </div>

    <!-- Data Grid -->
    <div class="orb-card__content" *ngIf="!(error$ | async)">
      <app-data-grid
        [columns]="columns"
        [data]="(filteredUserRows$ | async) || []"
        [pageState]="pageState"
        [sortState]="sortState"
        [filterState]="filterState"
        [loading]="(isLoading$ | async) || false"
        [showFilters]="true"
        [showPagination]="true"
        [showReset]="true"
        [selectable]="false"
        trackByField="user"
        emptyMessage="No users found"
        (pageChange)="onPageChange($event)"
        (sortChange)="onSortChange($event)"
        (filterChange)="onFilterChange($event)"
        (resetGrid)="onResetGrid()"
        (rowClick)="onRowClick($event)">
      </app-data-grid>
    </div>
  </div>

</app-user-page>

<!-- Custom Cell Templates -->

<!-- User Info Cell -->
<ng-template #userInfoCell let-row>
  <div class="orb-info">
    <div class="orb-info__name">{{ row.user.firstName }} {{ row.user.lastName }}</div>
    <div class="orb-info__id">{{ row.user.userId }}</div>
  </div>
</ng-template>

<!-- Status Cell -->
<ng-template #statusCell let-row>
  <app-status-badge 
    [status]="row.userStatus" 
    type="user"
    [showIcon]="true"
    [showLabel]="true"
    size="small"
    variant="chip">
  </app-status-badge>
</ng-template>

<!-- Application Count Cell -->
<ng-template #applicationCountCell let-row>
  <button 
    class="orb-count orb-count--clickable"
    (click)="onApplicationCountClick($event, row)"
    [attr.aria-label]="'View ' + row.applicationCount + ' applications for ' + row.user.firstName + ' ' + row.user.lastName">
    <fa-icon icon="layer-group" class="orb-count__icon"></fa-icon>
    {{ row.applicationCount }}
  </button>
</ng-template>

<!-- Last Activity Cell -->
<ng-template #lastActivityCell let-row>
  <span class="orb-info__id">{{ row.lastActivity }}</span>
</ng-template>
