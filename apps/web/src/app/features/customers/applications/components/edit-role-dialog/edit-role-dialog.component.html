<!-- Edit Role Dialog Template -->
<div *ngIf="isOpen && role"
  class="dialog-overlay"
  (click)="onClose()"
  (keyup.escape)="onClose()"
  tabindex="-1"
  role="presentation">
  <div class="dialog" (click)="$event.stopPropagation()" (keyup)="$event.stopPropagation()" role="dialog" aria-labelledby="dialog-title" aria-modal="true">
    
    <!-- Edit State -->
    <ng-container *ngIf="dialogState === 'edit'">
      <div class="dialog__header">
        <h3 id="dialog-title" class="dialog__title">
          <fa-icon icon="edit" class="dialog__title-icon"></fa-icon>
          Edit Role
        </h3>
        <button
          class="dialog__close"
          (click)="onClose()"
          aria-label="Close dialog">
          <fa-icon icon="times"></fa-icon>
        </button>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSave()">
        <div class="dialog__body">
          <!-- Status Badge -->
          <div class="dialog__status-row">
            <span class="dialog__status-label">Status:</span>
            <span class="dialog__status-badge" [ngClass]="'dialog__status-badge--' + statusClass">
              {{ statusLabel }}
            </span>
          </div>

          <!-- Error Messages -->
          <div *ngIf="updateError$ | async as error" class="dialog__error" role="alert">
            <fa-icon icon="exclamation-triangle"></fa-icon>
            {{ error }}
          </div>
          <div *ngIf="deleteError$ | async as error" class="dialog__error" role="alert">
            <fa-icon icon="exclamation-triangle"></fa-icon>
            {{ error }}
          </div>

          <!-- Role Name -->
          <div class="dialog__form-group">
            <label for="edit-role-name" class="dialog__label">Role Name *</label>
            <input
              id="edit-role-name"
              type="text"
              class="dialog__input"
              [class.dialog__input--error]="roleNameError"
              formControlName="roleName"
              placeholder="e.g., Editor, Moderator, Analyst"
              maxlength="100">
            <div *ngIf="roleNameError" class="dialog__field-error">
              {{ roleNameError }}
            </div>
          </div>

          <!-- Role Type -->
          <div class="dialog__form-group">
            <span id="edit-role-type-label" class="dialog__label">Role Type *</span>
            <div class="dialog__role-types" role="radiogroup" aria-labelledby="edit-role-type-label">
              <label
                *ngFor="let type of roleTypes"
                class="dialog__role-type"
                [class.dialog__role-type--selected]="form.get('roleType')?.value === type.value"
                [attr.for]="'edit-role-type-' + type.value">
                <input
                  [id]="'edit-role-type-' + type.value"
                  type="radio"
                  formControlName="roleType"
                  [value]="type.value"
                  class="dialog__role-type-input">
                <fa-icon [icon]="type.icon" class="dialog__role-type-icon"></fa-icon>
                <span class="dialog__role-type-label">{{ type.label }}</span>
              </label>
            </div>
          </div>

          <!-- Description -->
          <div class="dialog__form-group">
            <label for="edit-role-description" class="dialog__label">Description</label>
            <textarea
              id="edit-role-description"
              class="dialog__textarea"
              [class.dialog__textarea--error]="descriptionError"
              formControlName="description"
              placeholder="Describe what this role can do..."
              rows="3"
              maxlength="500"></textarea>
            <div class="dialog__char-count">
              {{ form.get('description')?.value?.length || 0 }}/500
            </div>
            <div *ngIf="descriptionError" class="dialog__field-error">
              {{ descriptionError }}
            </div>
          </div>

          <!-- Role ID (read-only) -->
          <div class="dialog__metadata">
            <div class="dialog__metadata-item">
              <span class="dialog__metadata-label">Role ID:</span>
              <code class="dialog__metadata-value">{{ role.applicationRoleId }}</code>
            </div>
          </div>
        </div>

        <div class="dialog__footer">
          <div class="dialog__footer-left">
            <button
              type="button"
              class="dialog__btn dialog__btn--danger-outline"
              (click)="onDelete()"
              [disabled]="isDeleting$ | async">
              <fa-icon icon="trash"></fa-icon>
              Delete
            </button>
            <button
              *ngIf="canDeactivate"
              type="button"
              class="dialog__btn dialog__btn--warning"
              (click)="onDeactivate()"
              [disabled]="isUpdating$ | async">
              <fa-icon icon="ban"></fa-icon>
              Deactivate
            </button>
          </div>
          <div class="dialog__footer-right">
            <button type="button" class="dialog__btn dialog__btn--secondary" (click)="onClose()">
              Cancel
            </button>
            <button
              type="submit"
              class="dialog__btn dialog__btn--primary"
              [disabled]="(isUpdating$ | async) || form.invalid">
              <fa-icon *ngIf="isUpdating$ | async" icon="spinner" animation="spin"></fa-icon>
              <span *ngIf="(isUpdating$ | async) === false">Save Changes</span>
              <span *ngIf="isUpdating$ | async">Saving...</span>
            </button>
          </div>
        </div>
      </form>
    </ng-container>

    <!-- Confirm Delete State -->
    <ng-container *ngIf="dialogState === 'confirm-delete'">
      <div class="dialog__header">
        <h3 id="dialog-title" class="dialog__title">
          <fa-icon icon="exclamation-triangle" class="dialog__title-icon dialog__title-icon--danger"></fa-icon>
          Delete Role
        </h3>
      </div>

      <div class="dialog__body">
        <div class="dialog__confirm-message">
          <p>Are you sure you want to delete the role <strong>{{ role.roleName }}</strong>?</p>
          <p class="dialog__confirm-warning-text">
            This action cannot be undone. Users assigned to this role will lose their permissions.
          </p>
        </div>
      </div>

      <div class="dialog__footer">
        <button
          type="button"
          class="dialog__btn dialog__btn--secondary"
          (click)="onCancelDelete()">
          Cancel
        </button>
        <button
          type="button"
          class="dialog__btn dialog__btn--danger"
          (click)="onConfirmDelete()"
          [disabled]="isDeleting$ | async">
          <fa-icon *ngIf="isDeleting$ | async" icon="spinner" animation="spin"></fa-icon>
          <span *ngIf="(isDeleting$ | async) === false">Delete Role</span>
          <span *ngIf="isDeleting$ | async">Deleting...</span>
        </button>
      </div>
    </ng-container>

  </div>
</div>
