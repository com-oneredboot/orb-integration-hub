<!-- Group Detail Component Template -->
<div class="group-detail" *ngIf="group || isInCreateMode">
  <!-- Header -->
  <div class="group-detail__header">
    <div class="group-detail__header-left">
      <button class="group-detail__back-btn" (click)="onClose()" aria-label="Close group detail">
        <fa-icon icon="arrow-left"></fa-icon>
      </button>
      <h3 class="group-detail__title">
        {{ isInCreateMode ? 'Create New Group' : group?.name }}
      </h3>
    </div>
    <div class="group-detail__header-actions" *ngIf="!isInCreateMode && !isEditing">
      <button class="group-detail__btn group-detail__btn--secondary" (click)="onEditGroup()">
        <fa-icon icon="edit"></fa-icon>
        Edit
      </button>
      <button class="group-detail__btn group-detail__btn--danger" (click)="onDeleteGroup()">
        <fa-icon icon="trash"></fa-icon>
        Delete
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="group-detail__tabs" *ngIf="!isInCreateMode">
    <button
      class="group-detail__tab"
      [class.group-detail__tab--active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')">
      Overview
    </button>
    <button
      class="group-detail__tab"
      [class.group-detail__tab--active]="activeTab === 'members'"
      (click)="setActiveTab('members')">
      Members
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="saveError$ | async as error" class="group-detail__error" role="alert">
    <fa-icon icon="exclamation-triangle"></fa-icon>
    {{ error }}
  </div>

  <!-- Content -->
  <div class="group-detail__content">
    <!-- Overview Tab / Edit Form -->
    <div *ngIf="activeTab === 'overview' || isInCreateMode" class="group-detail__overview">
      <!-- Edit/Create Form -->
      <form *ngIf="isEditing" class="group-detail__form" (ngSubmit)="onSaveGroup()">
        <div class="group-detail__form-group">
          <label for="groupName" class="group-detail__label">Name *</label>
          <input
            type="text"
            id="groupName"
            class="group-detail__input"
            [class.group-detail__input--error]="validationErrors.name"
            [(ngModel)]="editForm.name"
            name="name"
            placeholder="Enter group name"
            required />
          <span *ngIf="validationErrors.name" class="group-detail__error-text">
            {{ validationErrors.name }}
          </span>
        </div>

        <div class="group-detail__form-group">
          <label for="groupDescription" class="group-detail__label">Description</label>
          <textarea
            id="groupDescription"
            class="group-detail__textarea"
            [(ngModel)]="editForm.description"
            name="description"
            placeholder="Enter group description (optional)"
            rows="3">
          </textarea>
        </div>

        <div class="group-detail__form-actions">
          <button
            type="button"
            class="group-detail__btn group-detail__btn--secondary"
            (click)="onCancelEdit()">
            Cancel
          </button>
          <button
            type="submit"
            class="group-detail__btn group-detail__btn--primary"
            [disabled]="isSaving$ | async">
            <fa-icon *ngIf="isSaving$ | async" icon="spinner" [spin]="true"></fa-icon>
            {{ isInCreateMode ? 'Create Group' : 'Save Changes' }}
          </button>
        </div>
      </form>

      <!-- View Mode -->
      <div *ngIf="!isEditing && group" class="group-detail__info">
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Name</span>
          <span class="group-detail__info-value">{{ group.name }}</span>
        </div>
        <div class="group-detail__info-row" *ngIf="group.description">
          <span class="group-detail__info-label">Description</span>
          <span class="group-detail__info-value">{{ group.description }}</span>
        </div>
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Status</span>
          <span class="group-detail__status group-detail__status--{{ getStatusClass(group.status) }}">
            {{ group.status }}
          </span>
        </div>
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Members</span>
          <span class="group-detail__info-value">{{ group.memberCount || 0 }}</span>
        </div>
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Group ID</span>
          <span class="group-detail__info-value group-detail__info-value--mono">
            {{ group.applicationGroupId }}
          </span>
        </div>
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Created</span>
          <span class="group-detail__info-value">{{ formatDate(group.createdAt) }}</span>
        </div>
        <div class="group-detail__info-row">
          <span class="group-detail__info-label">Last Updated</span>
          <span class="group-detail__info-value">{{ formatDate(group.updatedAt) }}</span>
        </div>
      </div>
    </div>


    <!-- Members Tab -->
    <div *ngIf="activeTab === 'members' && !isInCreateMode" class="group-detail__members">
      <div class="group-detail__members-header">
        <h4 class="group-detail__members-title">Group Members</h4>
        <button class="group-detail__btn group-detail__btn--primary" (click)="onAddMember()">
          <fa-icon icon="plus"></fa-icon>
          Add Member
        </button>
      </div>

      <!-- Members Error -->
      <div *ngIf="membersError$ | async as error" class="group-detail__error" role="alert">
        <fa-icon icon="exclamation-triangle"></fa-icon>
        {{ error }}
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoadingMembers$ | async" class="group-detail__loading">
        <fa-icon icon="spinner" [spin]="true"></fa-icon>
        Loading members...
      </div>

      <!-- Members List -->
      <div *ngIf="!(isLoadingMembers$ | async)" class="group-detail__members-list">
        <div
          *ngFor="let member of members$ | async"
          class="group-detail__member">
          <div class="group-detail__member-info">
            <fa-icon icon="user" class="group-detail__member-icon"></fa-icon>
            <div class="group-detail__member-details">
              <span class="group-detail__member-id">{{ member.userId }}</span>
              <span class="group-detail__member-status">{{ member.status }}</span>
            </div>
          </div>
          <button
            class="group-detail__btn group-detail__btn--icon group-detail__btn--danger"
            (click)="onRemoveMember(member)"
            aria-label="Remove member">
            <fa-icon icon="times"></fa-icon>
          </button>
        </div>

        <!-- Empty State -->
        <div
          *ngIf="(members$ | async)?.length === 0"
          class="group-detail__members-empty">
          <fa-icon icon="users" class="group-detail__members-empty-icon"></fa-icon>
          <p>No members in this group yet.</p>
          <button class="group-detail__btn group-detail__btn--primary" (click)="onAddMember()">
            Add First Member
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!group && !isInCreateMode" class="group-detail__empty">
  <fa-icon icon="users" class="group-detail__empty-icon"></fa-icon>
  <p>Select a group to view details</p>
</div>
