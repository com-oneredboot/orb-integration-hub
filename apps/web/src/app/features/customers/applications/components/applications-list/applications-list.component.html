<!-- Applications List Component Template -->
<!-- Uses NgRx store as single source of truth (store-first pattern) -->
<!-- @see .kiro/specs/store-centric-refactoring/design.md -->

<div class="orb-card">

  <!-- Header -->
  <div class="orb-card__header">
    <h2 class="orb-card__title">
      <fa-icon icon="rocket" class="orb-card__icon"></fa-icon>
      Applications
    </h2>
    <div class="orb-card__header-actions">
      <button class="orb-card-btn"
              (click)="onCreateApplication()">
        <fa-icon icon="plus" class="orb-card-btn__icon"></fa-icon>
        Create Application
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="orb-filters">
    <div class="orb-filters__group">
      <label class="orb-filters__label" for="app-search">Search</label>
      <div class="orb-filters__input-group">
        <fa-icon icon="search" class="orb-filters__icon"></fa-icon>
        <input
          type="text"
          id="app-search"
          class="orb-filters__input"
          placeholder="Search applications..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()">
      </div>
    </div>

    <div class="orb-filters__group">
      <label class="orb-filters__label" for="app-org-filter">Organization</label>
      <select
        id="app-org-filter"
        class="orb-filters__select"
        [(ngModel)]="organizationFilter"
        (change)="onFilterChange()">
        <option value="">All Organizations</option>
        <option *ngFor="let org of organizations$ | async" [value]="org.organizationId">
          {{ org.name }}
        </option>
      </select>
    </div>

    <div class="orb-filters__group">
      <label class="orb-filters__label" for="app-status-filter">Status</label>
      <select
        id="app-status-filter"
        class="orb-filters__select"
        [(ngModel)]="statusFilter"
        (change)="onFilterChange()">
        <option value="">All Statuses</option>
        <option value="ACTIVE">Active</option>
        <option value="INACTIVE">Inactive</option>
      </select>
    </div>
  </div>

  <!-- Applications Table -->
  <ng-container *ngIf="{ 
    rows: filteredApplicationRows$ | async,
    allRows: applicationRows$ | async,
    loading: isLoading$ | async
  } as data">
    <div class="orb-card__content orb-card__content--table">
      <div class="orb-table">
        <div class="orb-table__container">
          <table class="orb-table__element">
          <thead>
            <tr>
              <th class="orb-table__header">Application</th>
              <th class="orb-table__header">Status</th>
              <th class="orb-table__header">Organization</th>
              <th class="orb-table__header">Environments</th>
              <th class="orb-table__header">Role</th>
              <th class="orb-table__header">Last Activity</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of data.rows; trackBy: trackByApplicationId"
                class="orb-table__row orb-table__row--clickable"
                [class.orb-table__row--selected]="row.application.applicationId === selectedApplication?.applicationId"
                (click)="onRowClick(row.application)">

              <!-- Application Info -->
              <td class="orb-table__cell">
                <div class="orb-info">
                  <div class="orb-info__name">{{ row.application.name }}</div>
                  <div class="orb-info__id">{{ row.application.applicationId }}</div>
                </div>
              </td>

              <!-- Status -->
              <td class="orb-table__cell">
                <app-status-badge
                  [status]="row.application.status || 'ACTIVE'"
                  type="application"
                  [showIcon]="true"
                  [showLabel]="true"
                  size="small"
                  variant="chip">
                </app-status-badge>
              </td>

              <!-- Organization -->
              <td class="orb-table__cell">
                <span class="orb-info__name">{{ row.organizationName }}</span>
              </td>

              <!-- Environment Count -->
              <td class="orb-table__cell">
                <div class="orb-count">
                  <fa-icon icon="server" class="orb-count__icon"></fa-icon>
                  {{ row.environmentCount }}
                </div>
              </td>

              <!-- Role -->
              <td class="orb-table__cell">
                <span class="orb-role-badge orb-role-badge--{{ getRoleClass(row.userRole) }}">
                  {{ row.userRole }}
                </span>
              </td>

              <!-- Last Activity -->
              <td class="orb-table__cell">
                <span class="orb-info__id">{{ row.lastActivity }}</span>
              </td>

            </tr>

            <!-- Loading State -->
            <tr *ngIf="data.loading" class="orb-table__row orb-table__row--loading">
              <td colspan="6" class="orb-table__cell orb-table__cell--loading">
                <div class="orb-table__loading">
                  <fa-icon icon="spinner" class="orb-table__loading-icon fa-spin"></fa-icon>
                  Loading applications...
                </div>
              </td>
            </tr>

            <!-- Empty State -->
            <tr *ngIf="!data.loading && (!data.rows || data.rows.length === 0)"
                class="orb-table__row orb-table__row--empty">
              <td colspan="6" class="orb-table__cell orb-table__cell--empty">
                <div class="orb-table__empty">
                  <fa-icon icon="rocket" class="orb-table__empty-icon"></fa-icon>
                  <p class="orb-table__empty-text">
                    {{ (!data.allRows || data.allRows.length === 0) ? 'No applications found. Create your first application to get started.' : 'No applications match your filters' }}
                  </p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    </div>
  </ng-container>
</div>
