<!-- Organizations List Component Template -->

<div class="orb-card">
  <!-- Header -->
  <div class="orb-card__header">
    <h2 class="orb-card__title">
      <fa-icon icon="building" class="orb-card__icon"></fa-icon>
      Organizations
    </h2>
    <div class="orb-card__header-actions">
      <button class="orb-card-btn"
              [class.orb-card-btn--disabled]="!(currentUser$ | async)?.groups?.includes('CUSTOMER')"
              [title]="!(currentUser$ | async)?.groups?.includes('CUSTOMER') ? 'Only paying customers can create organizations (DEBUG: Click anyway)' : ''"
              (click)="onCreateOrganization()">
        <fa-icon icon="plus" class="orb-card-btn__icon"></fa-icon>
        Create Organization {{ !(currentUser$ | async)?.groups?.includes('CUSTOMER') ? '(DEBUG)' : '' }}
      </button>
    </div>
  </div>

  <!-- Data Grid -->
  <div class="orb-card__content">
    <app-data-grid
      [columns]="columns"
      [data]="(filteredOrganizationRows$ | async) || []"
      [pageState]="pageState"
      [sortState]="sortState"
      [filterState]="filterState"
      [loading]="(isLoading$ | async) || false"
      [showFilters]="true"
      [showPagination]="true"
      [showReset]="true"
      [selectable]="false"
      trackByField="organization"
      emptyMessage="No organizations found"
      (pageChange)="onPageChange($event)"
      (sortChange)="onSortChange($event)"
      (filterChange)="onFilterChange($event)"
      (resetGrid)="onResetGrid()"
      (rowClick)="onRowClick($event)">
    </app-data-grid>
  </div>
</div>

<!-- Custom Cell Templates -->

<!-- Organization Info Cell -->
<ng-template #orgInfoCell let-row let-value="value">
  <div class="orb-info">
    <div class="orb-info__name">{{ row.organization.name }}</div>
    <div class="orb-info__id">{{ row.organization.organizationId }}</div>
  </div>
</ng-template>

<!-- Status Cell -->
<ng-template #statusCell let-row>
  <app-status-badge 
    [status]="row.organization.status" 
    type="organization"
    [showIcon]="true"
    [showLabel]="true"
    size="small"
    variant="chip">
  </app-status-badge>
</ng-template>

<!-- Role Cell -->
<ng-template #roleCell let-row>
  <span class="orb-role-badge orb-role-badge--{{ getRoleClass(row.userRole) }}">
    {{ row.userRole }}
  </span>
</ng-template>

<!-- Member Count Cell -->
<ng-template #memberCountCell let-row>
  <div class="orb-count">
    <fa-icon icon="users" class="orb-count__icon"></fa-icon>
    {{ row.memberCount }}
  </div>
</ng-template>

<!-- Application Count Cell -->
<ng-template #appCountCell let-row>
  <button 
    class="orb-count orb-count--clickable"
    (click)="onApplicationCountClick($event, row)"
    [attr.aria-label]="'View ' + (row.organization.applicationCount || 0) + ' applications for ' + row.organization.name">
    <fa-icon icon="rocket" class="orb-count__icon"></fa-icon>
    {{ row.organization.applicationCount || 0 }}
  </button>
</ng-template>

<!-- Last Activity Cell -->
<ng-template #lastActivityCell let-row>
  <span class="orb-info__id">{{ row.lastActivity }}</span>
</ng-template>
